<!DOCTYPE html>
<html lang="es">
<head>
.valor-actual {
  text-align: center;
  font-size: 1.3rem;
  font-weight: bold;
  color: #333;
  margin-bottom: 10px;
}
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Estaci√≥n Meteorol√≥gica</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(to bottom, #e0f7fa, #f1f8ff);
      color: #333;
    }

    header {
      background: #00bcd4;
      color: white;
      padding: 1.5rem;
      text-align: center;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    main {
      max-width: 1000px;
      margin: auto;
      padding: 1rem;
    }

    .grafico-container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      padding: 1.5rem;
      margin: 2rem auto;
    }

    h2 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
      color: #00bcd4;
      text-align: center;
    }

    canvas {
      width: 100% !important;
      max-height: 340px;
      height: auto !important;
    }

    @media (max-width: 600px) {
      header h1 {
        font-size: 1.3rem;
      }

      h2 {
        font-size: 1rem;
      }

      .grafico-container {
        padding: 1rem;
        margin: 1.5rem auto;
      }
    }
  </style>
</head>
<body>

  <header>
    <h1>üì° Estaci√≥n Meteorol√≥gica</h1>
  </header>

  <main>
    <div class="grafico-container">
      <h2>üå°Ô∏è Temperatura (¬∞C)</h2>
<div class="valor-actual" id="valorTemp">--</div>
<canvas id="graficoTemp"></canvas>
     
    </div>

    <div class="grafico-container">
      <h2>üíß Humedad (%)</h2>
     <div class="valor-actual" id="valorPres">--</div>
<canvas id="graficoPres"></canvas>
    </div>

    <div class="grafico-container">
      <h2>üìè Presi√≥n (hPa)</h2>
  <div class="valor-actual" id="valorHum">--</div>
<canvas id="graficoHum"></canvas>
    </div>

  
  </main>

<script>
const canalID = 2991138;
const apiKey = "CQCKW0T4ORH6UR3H";
const apiKeyOW = "9ee5d7e13cf00cdb7b2696791348f6af";
const lat = -34.61;
const lon = -58.38;

const campos = [
  { id: 1, nombre: "Temperatura (¬∞C)", color: "#ff5252", canvasId: "graficoTemp", compararOW: true },
  { id: 2, nombre: "Presi√≥n (hPa)", color: "#00cc66", canvasId: "graficoPres", compararOW: true },
  { id: 3, nombre: "Humedad (%)", color: "#00aaff", canvasId: "graficoHum", compararOW: true },
  
];

let charts = {}; // guardamos las instancias Chart.js

function cargarGraficos() {
  campos.forEach(campo => {
    const url = `https://api.thingspeak.com/channels/${canalID}/fields/${campo.id}.json?api_key=${apiKey}&results=60`;

    fetch(url)
      .then(res => res.json())
      .then(data => {
        const feeds = data.feeds;
        const labels = feeds.map(e => {
          const hora = new Date(e.created_at);
          return hora.toLocaleTimeString("es-AR", { hour: "2-digit", minute: "2-digit" });
        });

        const valores = feeds.map(e => parseFloat(e[`field${campo.id}`]));

        if (campo.compararOW && campo.id <= 3) {
          fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKeyOW}`)
            .then(res => res.json())
            .then(owData => {
              const valorOW = campo.id === 1 ? owData.main.temp :
                              campo.id === 2 ? owData.main.pressure :
                              owData.main.humidity;

              const datosOW = new Array(valores.length).fill(valorOW);

              renderizarGrafico(campo.canvasId, labels, [
                {
                  label: "Mi estaci√≥n",
                  data: valores,
                  borderColor: campo.color,
                  backgroundColor: campo.color + "33",
                  fill: true,
                  tension: 0.3,
                  pointRadius: 2
                },
                {
                  label: "OpenWeather",
                  data: datosOW,
                  borderColor: "#3399ff",
                  borderDash: [5, 5],
                  fill: false,
                  tension: 0.1,
                  pointRadius: 0
                }
              ], campo.nombre);
            });
        } else {
          renderizarGrafico(campo.canvasId, labels, [{
            label: campo.nombre,
            data: valores,
            borderColor: campo.color,
            backgroundColor: campo.color + "33",
            fill: true,
            tension: 0.3,
            pointRadius: 2
          }], campo.nombre);
        }
      })
      .catch(err => console.error(`Error en campo ${campo.id}:`, err));
  });
}

function renderizarGrafico(canvasId, labels, datasets, titulo) {
  const ctx = document.getElementById(canvasId).getContext("2d");

  if (charts[canvasId]) {
    charts[canvasId].data.labels = labels;
    charts[canvasId].data.datasets = datasets;
    charts[canvasId].update();
  } else {
    charts[canvasId] = new Chart(ctx, {
      type: "line",
      data: {
        labels: labels,
        datasets: datasets
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: true },
          title: {
            display: true,
            text: titulo
          }
        },
        scales: {
          x: {
            title: { display: true, text: "Hora" },
            ticks: {
              maxTicksLimit: 12,
              autoSkip: true,
              maxRotation: 0,
              minRotation: 0
            }
          },
          y: {
            beginAtZero: false,
            title: { display: true, text: titulo }
          }
        }
      }
    });
  }
}

// Ejecutar ahora
cargarGraficos();

// Ejecutar cada 60 segundos
setInterval(cargarGraficos, 60000);
</script>

</body>
</html>
